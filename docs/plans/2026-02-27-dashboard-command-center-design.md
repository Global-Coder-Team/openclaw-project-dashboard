# Dashboard Command Center Design

> Date: 2026-02-27
> Status: Approved

## Purpose

Evolve the project dashboard from a simple project viewer into a command center for managing an autonomous OpenClaw agent. The admin needs to see everything happening in real time, direct the agent's work (including overnight), and monitor scheduled tasks — all from one interface.

## Core Concepts

### Work Queue

An ordered list of instructions for the agent. Each item has:

- **rank** — explicit sort order (lower = higher priority)
- **projectId** — optional link to a project
- **instruction** — what to do
- **status** — `pending` | `in_progress` | `completed` | `skipped`
- **source** — `human` | `agent`

The admin reorders, adds, and removes items through the dashboard UI. The agent consumes them via a generated markdown file.

### Activity Log

A unified timeline of high-level events across all projects:

- **source** — `human` | `agent`
- **action** — `task_started`, `task_completed`, `status_changed`, `update_added`, `queue_picked`, `queue_completed`, `cron_ran`, `cron_failed`
- **projectId** — optional
- **detail** — optional description

Activity events are generated automatically as side effects of mutations. No manual logging required.

### Cron Health

Extends the existing read-only cron view:

- Health indicator per job (green/yellow/red) derived from recent success/failure
- Run history with timestamps and results
- Control stubs (enable/disable/trigger) wired up later when the cron API is understood

Cron data remains sourced from the OpenClaw state directory. A `cron_snapshots` table tracks observed state changes between poll cycles.

## Markdown Bridge

The dashboard writes `AGENT_QUEUE.md` to the workspace directory. This is the transport layer between the dashboard and the agent's existing md-reading behavior.

### File structure

```markdown
# Agent Work Queue
> Auto-generated by Project Dashboard. Do not edit manually.
> Last updated: 2026-02-27T03:45:00Z

## Priority Queue
1. [Project: GoatPort] Finish the onboarding flow — wire up email verification
2. [Project: OCI Grants] Draft the Q2 grant application using the template in /docs
3. [Global] Review all cron job failures from the last 24 hours and fix or escalate

## Per-Project Standing Instructions
### GoatPort (SaaS)
- Focus on onboarding flow. Don't touch billing until onboarding is complete.

### OCI - Grants Pipeline
- Q2 deadline is March 15. Prioritize over other OCI work.

## Recently Completed
- ~~[GoatPort] Set up Stripe test environment~~ ✓
```

### Regeneration triggers

- Any queue mutation (add, reorder, update status, delete)
- Any project standing instruction change (strategy/objective/nextAction)

### Content sources

- **Priority Queue** — Queue table items with `pending` or `in_progress` status, ordered by rank. In-progress items marked with "→ IN PROGRESS".
- **Per-Project Standing Instructions** — Project `nextAction`, `strategy`, and `constraints` fields. Only projects with at least one populated field appear.
- **Recently Completed** — Last 10 completed queue items within 48 hours.

The file is deterministic: same data always produces the same output, making git diffs meaningful.

## Database Schema

### `queue` table

| Column | Type | Notes |
|---|---|---|
| id | TEXT PK | Prefix: `q_` |
| projectId | TEXT | Nullable, FK to projects |
| instruction | TEXT NOT NULL | What to do |
| rank | INTEGER NOT NULL | Sort order |
| status | TEXT NOT NULL | pending/in_progress/completed/skipped |
| source | TEXT NOT NULL | human/agent |
| createdAt | INTEGER NOT NULL | |
| updatedAt | INTEGER NOT NULL | |

Index: `status, rank`

### `activity` table

| Column | Type | Notes |
|---|---|---|
| id | TEXT PK | Prefix: `a_` |
| projectId | TEXT | Nullable |
| source | TEXT NOT NULL | human/agent |
| action | TEXT NOT NULL | Event type |
| detail | TEXT | Optional description |
| createdAt | INTEGER NOT NULL | |

Index: `createdAt DESC`

### `cron_snapshots` table

| Column | Type | Notes |
|---|---|---|
| jobId | TEXT PK | |
| lastStatus | TEXT | success/failure/unknown |
| lastError | TEXT | |
| lastSeenAt | INTEGER | |

No changes to existing tables (projects, updates, tasks).

Migration follows the existing pattern: `CREATE TABLE IF NOT EXISTS` plus `ALTER TABLE ADD COLUMN` with existence checks.

## API Routes

### New routes

**Work Queue:**
- `GET /api/queue` — Ordered queue items
- `POST /api/queue` — Add item (`{projectId?, instruction, rank?}`)
- `POST /api/queue/update` — Update item (`{id, status?, instruction?, rank?}`)
- `POST /api/queue/reorder` — Bulk reorder (`{ids: [...]}`)
- `DELETE /api/queue/:id` — Remove item

**Activity Log:**
- `GET /api/activity` — Recent events (supports limit/offset)
- `POST /api/activity` — Log event (`{projectId?, source, action, detail?}`)

**Cron (extended):**
- `GET /api/cron` — Jobs with health indicators and run history
- `POST /api/cron/:id/trigger` — Stubbed
- `POST /api/cron/:id/toggle` — Stubbed

### Extended routes

`GET /api/state` adds `queue`, `activity` (last 20), and `cronHealth` fields to the existing response.

### Unchanged routes

`/api/projects`, `/api/projects/update`, `/api/updates`, `/api/tasks`, `/api/tasks/update` — all stay as-is.

### Automatic activity logging

| Mutation | Activity action |
|---|---|
| Queue item → in_progress | `queue_picked` |
| Queue item → completed | `queue_completed` |
| Task → doing | `task_started` |
| Task → done | `task_completed` |
| Project status changes | `status_changed` |
| Update added | `update_added` |
| Cron snapshot detects change | `cron_ran` or `cron_failed` |

Source detection: UI calls default to `human`. A `source` parameter can be passed on any mutation endpoint for agent-originated actions.

## UI Layout

### Split view

**Left panel — Command Center** (three collapsible sections):

1. **Work Queue** — Priority-ordered list. Drag to reorder, click to edit, quick-add input at top. Active item highlighted. Status badges per item.
2. **Cron Health** — Compact job list with colored health dots. Expandable per-job run history. Control buttons shown but disabled until cron API is confirmed.
3. **Activity Feed** — Reverse-chronological event stream. One line per event: timestamp, source badge (human/agent), description, project link.

**Right panel — Detail view** (evolved from current):

- Default "Dashboard" tab: aggregate stats (project count by status, queue depth, cron health summary, recent activity highlights)
- Existing tabs retained: Overview, Tasks, Schedules, Strategy, Updates
- Clicking any project name in the left panel opens that project in the right panel

### Global behavior

- Auto-refresh polling every 15 seconds on `/api/state`
- Header shows last refresh timestamp with subtle pulse animation
- "Offline" indicator if fetch fails — no alerts or blocking
- Manual refresh button retained

### Design direction

- Keep existing dark theme and visual style
- Vanilla JS SPA (no framework)
- Extend current CSS variables and card/item patterns
